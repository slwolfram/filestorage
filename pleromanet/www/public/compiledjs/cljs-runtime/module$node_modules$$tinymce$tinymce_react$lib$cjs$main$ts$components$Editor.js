shadow$provide.module$node_modules$$tinymce$tinymce_react$lib$cjs$main$ts$components$Editor=function(global,require,module,exports){var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=
d}if("function"!==typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),__assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p])}return t};return __assign.apply(this,arguments)};Object.defineProperty(exports,
"__esModule",{value:!0});exports.Editor=void 0;var React=require("module$node_modules$react$index"),ScriptLoader2_1=require("module$node_modules$$tinymce$tinymce_react$lib$cjs$main$ts$ScriptLoader2"),TinyMCE_1=require("module$node_modules$$tinymce$tinymce_react$lib$cjs$main$ts$TinyMCE"),Utils_1=require("module$node_modules$$tinymce$tinymce_react$lib$cjs$main$ts$Utils"),EditorPropTypes_1=require("module$node_modules$$tinymce$tinymce_react$lib$cjs$main$ts$components$EditorPropTypes");global=function(_super){function Editor(props){var _a$jscomp$1,
_b$jscomp$1,_c,_this=_super.call(this,props)||this;_this.rollbackTimer=void 0;_this.valueCursor=void 0;_this.rollbackChange=function(){var editor=_this.editor,value=_this.props.value;editor&&value&&value!==_this.currentContent&&editor.undoManager.ignore(function(){editor.setContent(value);if(_this.valueCursor&&(!_this.inline||editor.hasFocus()))try{editor.selection.moveToBookmark(_this.valueCursor)}catch(e){}});_this.rollbackTimer=void 0};_this.handleBeforeInput=function(_evt){if(void 0!==_this.props.value&&
_this.props.value===_this.currentContent&&_this.editor&&(!_this.inline||_this.editor.hasFocus()))try{_this.valueCursor=_this.editor.selection.getBookmark(3)}catch(e){}};_this.handleBeforeInputSpecial=function(evt){"Enter"!==evt.key&&"Backspace"!==evt.key&&"Delete"!==evt.key||_this.handleBeforeInput(evt)};_this.handleEditorChange=function(_evt){if((_evt=_this.editor)&&_evt.initialized){var newContent=_evt.getContent();void 0===_this.props.value||_this.props.value===newContent||!1===_this.props.rollback||
_this.rollbackTimer||(_this.rollbackTimer=window.setTimeout(_this.rollbackChange,"number"===typeof _this.props.rollback?_this.props.rollback:200));if(newContent!==_this.currentContent&&(_this.currentContent=newContent,(0,Utils_1.isFunction)(_this.props.onEditorChange)))_this.props.onEditorChange(newContent,_evt)}};_this.handleEditorChangeSpecial=function(evt){"Backspace"!==evt.key&&"Delete"!==evt.key||_this.handleEditorChange(evt)};_this.initialise=function(attempts){var _a$jscomp$0,_b$jscomp$0,_c;
void 0===attempts&&(attempts=0);var target=_this.elementRef.current;if(target)if((0,Utils_1.isInDoc)(target)){var tinymce=(0,TinyMCE_1.getTinymce)(_this.view);if(!tinymce)throw Error("tinymce should have been loaded into global scope");var finalInit=__assign(__assign({},_this.props.init),{selector:void 0,target,readonly:_this.props.disabled,inline:_this.inline,plugins:(0,Utils_1.mergePlugins)(null===(_a$jscomp$0=_this.props.init)||void 0===_a$jscomp$0?void 0:_a$jscomp$0.plugins,_this.props.plugins),
toolbar:null!==(_b$jscomp$0=_this.props.toolbar)&&void 0!==_b$jscomp$0?_b$jscomp$0:null===(_c=_this.props.init)||void 0===_c?void 0:_c.toolbar,setup:function(editor){_this.editor=editor;_this.bindHandlers({});if(_this.inline&&!(0,Utils_1.isTextareaOrInput)(target))editor.once("PostRender",function(_evt){editor.setContent(_this.getInitialValue(),{no_events:!0})});_this.props.init&&(0,Utils_1.isFunction)(_this.props.init.setup)&&_this.props.init.setup(editor)},init_instance_callback:function(editor){var _a,
_b,initialValue=_this.getInitialValue();_this.currentContent=null!==(_a=_this.currentContent)&&void 0!==_a?_a:editor.getContent();_this.currentContent!==initialValue&&(_this.currentContent=initialValue,editor.setContent(initialValue),editor.undoManager.clear(),editor.undoManager.add(),editor.setDirty(!1));_a=null!==(_b=_this.props.disabled)&&void 0!==_b?_b:!1;(0,Utils_1.setMode)(_this.editor,_a?"readonly":"design");_this.props.init&&(0,Utils_1.isFunction)(_this.props.init.init_instance_callback)&&
_this.props.init.init_instance_callback(editor)}});_this.inline||(target.style.visibility="");(0,Utils_1.isTextareaOrInput)(target)&&(target.value=_this.getInitialValue());tinymce.init(finalInit)}else if(0===attempts)setTimeout(function(){return _this.initialise(1)},1);else if(100>attempts)setTimeout(function(){return _this.initialise(attempts+1)},100);else throw Error("tinymce can only be initialised when in a document");};_this.id=_this.props.id||(0,Utils_1.uuid)("tiny-react");_this.elementRef=
React.createRef();_this.inline=null!==(_c=null!==(_a$jscomp$1=_this.props.inline)&&void 0!==_a$jscomp$1?_a$jscomp$1:null===(_b$jscomp$1=_this.props.init)||void 0===_b$jscomp$1?void 0:_b$jscomp$1.inline)&&void 0!==_c?_c:!1;_this.boundHandlers={};return _this}__extends(Editor,_super);Object.defineProperty(Editor.prototype,"view",{get:function(){var _a,_b;return null!==(_b=null===(_a=this.elementRef.current)||void 0===_a?void 0:_a.ownerDocument.defaultView)&&void 0!==_b?_b:window},enumerable:!1,configurable:!0});
Editor.prototype.componentDidUpdate=function(prevProps){var _this=this,_a,_b;this.rollbackTimer&&(clearTimeout(this.rollbackTimer),this.rollbackTimer=void 0);if(this.editor&&(this.bindHandlers(prevProps),this.editor.initialized)){this.currentContent=null!==(_a=this.currentContent)&&void 0!==_a?_a:this.editor.getContent();if("string"===typeof this.props.initialValue&&this.props.initialValue!==prevProps.initialValue)this.editor.setContent(this.props.initialValue),this.editor.undoManager.clear(),this.editor.undoManager.add(),
this.editor.setDirty(!1);else if("string"===typeof this.props.value&&this.props.value!==this.currentContent){var localEditor_1=this.editor;localEditor_1.undoManager.transact(function(){if(!_this.inline||localEditor_1.hasFocus())try{var cursor=localEditor_1.selection.getBookmark(3)}catch(e){}var valueCursor=_this.valueCursor;localEditor_1.setContent(_this.props.value);if(!_this.inline||localEditor_1.hasFocus()){var _i=0;for(cursor=[cursor,valueCursor];_i<cursor.length;_i++)if(valueCursor=cursor[_i])try{localEditor_1.selection.moveToBookmark(valueCursor);
_this.valueCursor=valueCursor;break}catch(e){}}})}this.props.disabled!==prevProps.disabled&&(prevProps=null!==(_b=this.props.disabled)&&void 0!==_b?_b:!1,(0,Utils_1.setMode)(this.editor,prevProps?"readonly":"design"))}};Editor.prototype.componentDidMount=function(){var _this=this,_a$jscomp$0,_b$jscomp$0,_c,_d,_e;null!==(0,TinyMCE_1.getTinymce)(this.view)?this.initialise():Array.isArray(this.props.tinymceScriptSrc)&&0===this.props.tinymceScriptSrc.length?null===(_b$jscomp$0=(_a$jscomp$0=this.props).onScriptsLoadError)||
void 0===_b$jscomp$0?void 0:_b$jscomp$0.call(_a$jscomp$0,Error("No `tinymce` global is present but the `tinymceScriptSrc` prop was an empty array.")):(null===(_c=this.elementRef.current)||void 0===_c?0:_c.ownerDocument)&&ScriptLoader2_1.ScriptLoader.loadList(this.elementRef.current.ownerDocument,this.getScriptSources(),null!==(_e=null===(_d=this.props.scriptLoading)||void 0===_d?void 0:_d.delay)&&void 0!==_e?_e:0,function(){var _a,_b;null===(_b=(_a=_this.props).onScriptsLoad)||void 0===_b?void 0:
_b.call(_a);_this.initialise()},function(err){var _a,_b;null===(_b=(_a=_this.props).onScriptsLoadError)||void 0===_b?void 0:_b.call(_a,err)})};Editor.prototype.componentWillUnmount=function(){var _this=this,editor=this.editor;editor&&(editor.off(this.changeEvents(),this.handleEditorChange),editor.off(this.beforeInputEvent(),this.handleBeforeInput),editor.off("keypress",this.handleEditorChangeSpecial),editor.off("keydown",this.handleBeforeInputSpecial),editor.off("NewBlock",this.handleEditorChange),
Object.keys(this.boundHandlers).forEach(function(eventName){editor.off(eventName,_this.boundHandlers[eventName])}),this.boundHandlers={},editor.remove(),this.editor=void 0)};Editor.prototype.render=function(){return this.inline?this.renderInline():this.renderIframe()};Editor.prototype.changeEvents=function(){var _a,_b,_c;return(null===(_c=null===(_b=null===(_a=(0,TinyMCE_1.getTinymce)(this.view))||void 0===_a?void 0:_a.Env)||void 0===_b?void 0:_b.browser)||void 0===_c?0:_c.isIE())?"change keyup compositionend setcontent CommentChange":
"change input compositionend setcontent CommentChange"};Editor.prototype.beforeInputEvent=function(){return(0,Utils_1.isBeforeInputEventAvailable)()?"beforeinput SelectionChange":"SelectionChange"};Editor.prototype.renderInline=function(){var _a=this.props.tagName;return React.createElement(void 0===_a?"div":_a,{ref:this.elementRef,id:this.id})};Editor.prototype.renderIframe=function(){return React.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,
id:this.id})};Editor.prototype.getScriptSources=function(){var _a,_b,async=null===(_a=this.props.scriptLoading)||void 0===_a?void 0:_a.async,defer=null===(_b=this.props.scriptLoading)||void 0===_b?void 0:_b.defer;if(void 0!==this.props.tinymceScriptSrc)return"string"===typeof this.props.tinymceScriptSrc?[{src:this.props.tinymceScriptSrc,async,defer}]:this.props.tinymceScriptSrc.map(function(item){return"string"===typeof item?{src:item,async,defer}:item});_a=this.props.cloudChannel;return[{src:"https://cdn.tiny.cloud/1/".concat(this.props.apiKey?
this.props.apiKey:"no-api-key","/tinymce/").concat(_a,"/tinymce.min.js"),async,defer}]};Editor.prototype.getInitialValue=function(){return"string"===typeof this.props.initialValue?this.props.initialValue:"string"===typeof this.props.value?this.props.value:""};Editor.prototype.bindHandlers=function(prevProps){var _this=this;if(void 0!==this.editor){(0,Utils_1.configHandlers)(this.editor,prevProps,this.props,this.boundHandlers,function(key){return _this.props[key]});var isValueControlled=function(p){return void 0!==
p.onEditorChange||void 0!==p.value};prevProps=isValueControlled(prevProps);isValueControlled=isValueControlled(this.props);!prevProps&&isValueControlled?(this.editor.on(this.changeEvents(),this.handleEditorChange),this.editor.on(this.beforeInputEvent(),this.handleBeforeInput),this.editor.on("keydown",this.handleBeforeInputSpecial),this.editor.on("keyup",this.handleEditorChangeSpecial),this.editor.on("NewBlock",this.handleEditorChange)):prevProps&&!isValueControlled&&(this.editor.off(this.changeEvents(),
this.handleEditorChange),this.editor.off(this.beforeInputEvent(),this.handleBeforeInput),this.editor.off("keydown",this.handleBeforeInputSpecial),this.editor.off("keyup",this.handleEditorChangeSpecial),this.editor.off("NewBlock",this.handleEditorChange))}};Editor.propTypes=EditorPropTypes_1.EditorPropTypes;Editor.defaultProps={cloudChannel:"6"};return Editor}(React.Component);exports.Editor=global}
//# sourceMappingURL=module$node_modules$$tinymce$tinymce_react$lib$cjs$main$ts$components$Editor.js.map
